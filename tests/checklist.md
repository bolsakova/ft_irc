–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ IRC —Å–µ—Ä–≤–µ—Ä–∞ - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
üìã –ß–µ–∫-–ª–∏—Å—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
‚úÖ –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
 –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
 –°–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
 –°–µ—Ä–≤–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
 –°–µ—Ä–≤–µ—Ä –Ω–µ –∫—Ä–∞—à–∏—Ç—Å—è –ø—Ä–∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–º –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞
 –°–µ—Ä–≤–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –ø–æ Ctrl+C
‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
 PASS - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è
 PASS - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è
 NICK - –≤–∞–ª–∏–¥–Ω—ã–π –Ω–∏–∫ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
 NICK - –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –Ω–∏–∫ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è
 NICK - –∑–∞–Ω—è—Ç—ã–π –Ω–∏–∫ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è
 USER - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç username –∏ realname
 –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ PASS+NICK+USER
 Welcome-—Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚úÖ –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
 PING - –æ—Ç–≤–µ—á–∞–µ—Ç PONG
 QUIT - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞
 PRIVMSG - –æ—Ç–ø—Ä–∞–≤–∫–∞ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
 PRIVMSG - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫–∞–Ω–∞–ª
‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞–º–∏
 JOIN - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–∞–Ω–∞–ª–∞
 JOIN - –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –∫–∞–Ω–∞–ª—É
 JOIN - –ø–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º
 PART - –≤—ã—Ö–æ–¥ –∏–∑ –∫–∞–Ω–∞–ª–∞
 NAMES - —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
 TOPIC - –ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–ø–∏–∫–∞
 TOPIC - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–æ–ø–∏–∫–∞ (–æ–ø–µ—Ä–∞—Ç–æ—Ä)
 KICK - –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–ø–µ—Ä–∞—Ç–æ—Ä)
 INVITE - –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚úÖ –†–µ–∂–∏–º—ã –∫–∞–Ω–∞–ª–æ–≤
 MODE +i/-i - invite-only —Ä–µ–∂–∏–º
 MODE +t/-t - topic protection
 MODE +k/-k - —É—Å—Ç–∞–Ω–æ–≤–∫–∞/—Å–Ω—è—Ç–∏–µ –ø–∞—Ä–æ–ª—è –∫–∞–Ω–∞–ª–∞
 MODE +o/-o - –≤—ã–¥–∞—á–∞/—Å–Ω—è—Ç–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
 MODE +l/-l - —É—Å—Ç–∞–Ω–æ–≤–∫–∞/—Å–Ω—è—Ç–∏–µ –ª–∏–º–∏—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
 MODE –ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–∏—Ö —Ä–µ–∂–∏–º–æ–≤


Problem - test 12:

**–≠—Ç–æ –ë–ê–ì! ‚ùå**

## –ü—Ä–æ–±–ª–µ–º–∞:

–í CommandHandler.cpp —Ñ—É–Ω–∫—Ü–∏–∏ `handleJoin()` –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —É–¥–∞–ª—è–µ—Ç—Å—è **–î–û** –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–ª—é—á–∞ –∫–∞–Ω–∞–ª–∞:

```cpp
// –ü—Ä–æ–≤–µ—Ä–∫–∞ +i (invite-only)
if (chan->isInviteOnly())
{
    if (!chan->isInvited(client.getFD()))
    {
        sendError(client, ERR_INVITEONLYCHAN, channel_name, "Cannot join channel (+i)");
        return;
    }
    // ‚ùå –ë–ê–ì: –£–¥–∞–ª—è–µ–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –°–†–ê–ó–£
    chan->removeInvited(client.getFD());
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ +k (channel key)
if (chan->hasKey())
{
    if (key != chan->getKey())
    {
        // ‚ùå –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –£–ñ–ï —É–¥–∞–ª–µ–Ω–æ, –Ω–æ –∫–ª–∏–µ–Ω—Ç –ù–ï –≤–æ—à–µ–ª!
        sendError(client, ERR_BADCHANNELKEY, channel_name, "Cannot join channel (+k)");
        return;
    }
}
```

---

## –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–ø–æ RFC):

**–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ" —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –£–°–ü–ï–®–ù–û–ú –≤—Ö–æ–¥–µ –≤ –∫–∞–Ω–∞–ª!**

–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –Ω–µ —Å–º–æ–≥ –∑–∞–π—Ç–∏ –ø–æ –ª—é–±–æ–π –ø—Ä–∏—á–∏–Ω–µ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª—é—á, –∫–∞–Ω–∞–ª –ø–æ–ª–æ–Ω –∏ —Ç.–¥.), –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –æ—Å—Ç–∞—Ç—å—Å—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º.

---

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

```cpp
void CommandHandler::handleJoin(Client& client, const Message& msg) {
    // ... (–Ω–∞—á–∞–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

    if (is_new_channel)
    {
        chan = m_server.createChannel(channel_name);
        chan->addOperator(client.getFD());
        std::cout << "Created new channel: " << channel_name << ", operator: " << client.getNickname() << "\n";
    }
    else
    {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ +i (invite-only) - –ù–û –ù–ï –£–î–ê–õ–Ø–ï–ú –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ!
        if (chan->isInviteOnly())
        {
            if (!chan->isInvited(client.getFD()))
            {
                sendError(client, ERR_INVITEONLYCHAN, channel_name, "Cannot join channel (+i)");
                return;
            }
            // ‚úÖ –ù–ï —É–¥–∞–ª—è–µ–º –∑–¥–µ—Å—å! –£–¥–∞–ª–∏–º –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ addMember
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ +k (channel key)
        if (chan->hasKey())
        {
            if (key != chan->getKey())
            {
                sendError(client, ERR_BADCHANNELKEY, channel_name, "Cannot join channel (+k)");
                return;
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ +l (user limit)
        int limit = chan->getUserLimit();
        if (limit > 0 && static_cast<int>(chan->getMembers().size()) >= limit)
        {
            sendError(client, ERR_CHANNELISFULL, channel_name, "Cannot join channel (+l)");
            return;
        }
    }

    // ‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã - –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∫–∞–Ω–∞–ª
    chan->addMember(&client);

    // ‚úÖ –£–¥–∞–ª—è–µ–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –ü–û–°–õ–ï —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞
    if (chan->isInviteOnly() && chan->isInvited(client.getFD()))
    {
        chan->removeInvited(client.getFD());
    }

    // ... (–æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ - broadcast JOIN
}
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```irc
# alice
MODE #test +i
MODE #test +k secret123
INVITE bob #test

# bob (1-—è –ø–æ–ø—ã—Ç–∫–∞ - –±–µ–∑ –∫–ª—é—á–∞)
JOIN #test
# ‚ùå :ircserv 475 bob #test :Cannot join channel (+k)

# bob (2-—è –ø–æ–ø—ã—Ç–∫–∞ - —Å –∫–ª—é—á–æ–º, –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –í–°–ï –ï–©–ï –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ!)
JOIN #test secret123
# ‚úÖ :bob!bob@localhost JOIN :#test
```

**–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ - –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –≤—Ö–æ–¥–µ!**

---

## –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:

1. **RFC 1459 compliance** - –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ = "—Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –≤–æ–π—Ç–∏", –∞ –Ω–µ "–æ–¥–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞"
2. **–õ–æ–≥–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - –µ—Å–ª–∏ –º–µ–Ω—è –ø—Ä–∏–≥–ª–∞—Å–∏–ª–∏, —è –º–æ–≥—É –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤–æ–π—Ç–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ (–∑–∞–±—ã–ª –ø–∞—Ä–æ–ª—å, –æ–ø–µ—á–∞—Ç–∫–∞ –∏ —Ç.–¥.)
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ —Å–ª—É—á–∞–π–Ω–æ –ø–æ–ø—ã—Ç–∞–ª—Å—è –≤–æ–π—Ç–∏ –±–µ–∑ –ø–∞—Ä–æ–ª—è, –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–µ –¥–æ–ª–∂–Ω–æ —Å–≥–æ—Ä–∞—Ç—å

–ü—Ä–∏–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–Ω–æ–≤–∞!
